<div class="b-modal-window "  role="dialog">
  <div class="b-modal-window__overlay"></div>
    <div class="b-modal-window__main-block b-send-survey" focus-modal>
        <div class="b-modal-window__main-block__header">
            <h2 class="b-modal-window__main-block__header--title"
                role="heading">
                {{ 'surveys.Publish_survey_title' | translate }}
            </h2>
            <span class="b-modal-window__main-block__header--icon-close">
              <a  ui-sref="^" class="transparent-button" tabindex="1">
                <span class="fa fa-times"></span>
              </a>
            </span>
        </div>
        <div class="b-modal-window__main-block__body">
            <form name="sendSurveyForm" ng-model="sendSurveyForm" id="send-survey-form" ng-submit="sendSms($stateParams.groupId)">
                <ul class="b-send-survey__all-groups">
                    <h4>
                        <input type="checkbox" role="checkbox"
                               tabindex="2"
                               ng-model="allUsers.checked"
                               ng-checked="allUsers.checked"
                               ng-change="checkAllUsers(allUsers)">

                        <label class="expand close"
                               tabindex="3"
                               click="showUsers"
                               visible="allUsers.isVisible"
                               ng-click="showUsers()">
                            <span class="fa" ng-class="{'fa-caret-down': allUsers.isVisible,
                            'fa-caret-right': !allUsers.isVisible}"></span>
                            ({{allUsers.length}}) {{ 'users.All_users' | translate }}
                        </label>
                    </h4>
                    <div class="b-send-survey__all-users b-send-survey__groups-list__group" ng-show="allUsers.isVisible">
                        <li ng-repeat="user in allUsers" class="b-send-survey__all-groups__user">
                            <input type="checkbox" role="checkbox" name="{{user.username}}" id="{{user.username}}"
                                   tabindex="4"
                                   ng-model="user.checked"
                                   ng-checked="user.checked"
                                   ng-change="checkUser(allUsers, user, 'allUsers')">
                            <label for="{{user.username}}">{{user.name}}</label>
                        </li>
                    </div>
                </ul>
                <div class="b-send-survey__groups-list">
                    <ul  ng-repeat="group in groups">
                        <h4>
                            <input type="checkbox" role="checkbox" name="{{group.name}}" id="{{group.name}}"
                                   tabindex="5"
                                   ng-model="group.users.checked"
                                   ng-change="checkAllUsersInGroup(group.users)"
                                   ng-disabled="allUsers.checked || !group.users.length">
                            <label class="expand"
                                   for="{{group.name}}"
                                   tabindex="6"
                                   click="showUsersInGroup"
                                   visible="group.isVisible"
                                   ng-click="showUsersInGroup()"
                                   ng-class="{void: !group.users.length}">
                                <span class="fa" ng-show="group.users.length"
                                      ng-class="{'fa-caret-down': group.isVisible, 'fa-caret-right': !group.isVisible}"></span>

                                ({{group.users.length}}) {{group.name}}</label>
                        </h4>
                        <div class="{{group.name}} b-send-survey__groups-list__group" ng-show="group.isVisible">
                            <li ng-repeat="user in group.users" class="b-send-survey__all-groups__user">
                                <input type="checkbox" role="checkbox" name="{{user.username}}" id="{{user.username}}"
                                       tabindex="7"
                                       ng-model="user.checked"
                                       ng-checked="user.checked"
                                       ng-change="checkUser(group.users, user, 'group')"
                                       ng-disabled="allUsers.checked">
                                <label for="{{user.username}}">{{user.name}}</label>
                            </li>
                        </div>
                    </ul>
                </div>

                <button type="button" class="b-modal-window__main-block__body__button"
                        role="button"
                        tabindex="8"
                        ng-disabled="usersIds"
                        ng-click="sendSurvey($stateParams.surveyId)">
                    <span class="fa fa-share b-modal-window__main-block__body__button--icon" ></span>
                    <span>{{ 'surveys.Publish_survey' | translate }}</span>
                </button>

            </form>
        </div>
    </div>
</div>
